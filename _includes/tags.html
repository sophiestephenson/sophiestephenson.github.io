{%- assign _tag_max_size = 1 -%}
{%- assign _tag_min_size = 1 -%}
{%- assign _tag_cur_size = 1 -%}
{%- assign _category = include.category -%}
{%- assign _num_posts = 0 -%}

{%- assign rawtags = "" -%}
{%- for post in site.posts -%}
  {%- if post.category == _category -%}
    {%- assign _num_posts = _num_posts | plus: 1 -%}
    {%- assign ttags = post.tags | join: '|' | append: '|' -%}
    {%- assign rawtags = rawtags | append:ttags -%}
  {%- endif -%}
{%- endfor -%}
{%- assign rawtags = rawtags | split: '|' | sort -%}

{% assign _tags = "" %}
{% for tag in rawtags %}
  {% if tag != "" %}
    {% if _tags == "" %}
      {% assign _tags = tag | split:'|' %}
    {% endif %}
    {% unless tags contains tag %}
      {% assign _tags = _tags | join:'|' | append:'|' | append:tag | split:'|' %}
    {% endunless %}
  {% endif %}
{% endfor %}

<div class="site-tags js-tags">
  <ul class="menu">
    <li>
      <button type="button" class="button button--secondary button--pill tag-button tag-button--all" data-encode="">
        Show All<div class="tag-button__count">{{ _num_posts }}</div>
      </button>
    </li>
    {%- for _tag in _tags -%}
      <li><button type="button" class="button button--pill tag-button tag-button-1" data-encode="{{ _tag | strip | url_encode }}">
          <span>{{ _tag | strip }}</span>
        </button>
      </li>
    {%- endfor -%}
  </ul>
</div>
